(function(){function b(){return b}function c(b,d){var e=c.resolve(b),f=c.modules[e];if(!f)throw new Error('failed to require "'+b+'" from '+d);return f.exports||(f.exports={},f.call(f.exports,f,f.exports,c.relative(e),a)),f.exports}var a=this;c.modules={},c.resolve=function(a){var b=a,d=a+".js",e=a+"/index.js";return c.modules[d]&&d||c.modules[e]&&e||b},c.register=function(a,b){c.modules[a]=b},c.relative=function(a){return function(d){if("debug"==d)return b;if("."!=d.charAt(0))return c(d);var e=a.split("/"),f=d.split("/");e.pop();for(var g=0;g<f.length;g++){var h=f[g];".."==h?e.pop():"."!=h&&e.push(h)}return c(e.join("/"),a)}},c.register("index.js",function(a,b,c,d){function g(){if(window.XMLHttpRequest&&("file:"!=window.location.protocol||!window.ActiveXObject))return new XMLHttpRequest;try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(a){}try{return new ActiveXObject("Msxml2.XMLHTTP.6.0")}catch(a){}try{return new ActiveXObject("Msxml2.XMLHTTP.3.0")}catch(a){}try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(a){}return!1}var e=c("./parser"),f=c("./bvh");b.read=function(a,c){var d=g();d.onreadystatechange=function(){d.readyState===4&&d.status===200&&c(b.parse(d.responseText))},d.open("GET",a,!0),d.send()},b.parse=function(a){var b=a.replace("\r","").split("\n");return new f((new e(b)).parse())}}),c.register("parser.js",function(a,b,c,d){function f(a){this._lines=a,this._lineNumber=-1,this.currentNode=null,this.next()}var e=c("./bvh_node");a.exports=f,f.prototype.parse=function(){this.expect("HIERARCHY").root().motion();if(this.get())throw new Error("Parse error: Invalid token "+this.get()+".");return this},f.prototype.root=function(){var a=this,b;this.expect("ROOT",function(c){var d=c.split(/\s+/)[1];b=new e(d),a.currentNode=b}).expect("{").offset().channels();while(this.accept("JOINT"))this.joint(),this.currentNode=b;return this.accept("End")&&this.end(),this.expect("}"),this},f.prototype.joint=function(){var a=this,b;this.expect("JOINT",function(c){var d=c.split(/\s+/)[1];b=new e(d),b.parent=a.currentNode,a.currentNode.children.push(b),a.currentNode=b}).expect("{").offset().channels();while(this.accept("JOINT"))this.joint(),this.currentNode=b;return this.accept("End")&&this.end(),this.expect("}"),this},f.prototype.end=function(){if(this.get(0)!=="End Site")throw new Error("Parse error: End Site expected, but "+this.get()+".");return this.next().expect("{").endOffset().expect("}"),this},f.prototype.offset=function(){var a=this.get().split(/\s+/).slice(1);if(a.length!==3)throw new Error("Parse error: Invalid offset number.");return this.currentNode.offsetX=+a[0],this.currentNode.offsetY=+a[1],this.currentNode.offsetZ=+a[2],this.next()},f.prototype.endOffset=function(){var a=this.get().split(/\s+/).slice(1);if(a.length!==3)throw new Error("Parse error: Invalid offset number.");return this.currentNode.hasEnd=!0,this.currentNode.endOffsetX=+a[0],this.currentNode.endOffsetY=+a[1],this.currentNode.endOffsetZ=+a[2],this.next()},f.prototype.channels=function(){var a=this.get(0).split(/\s+/),b=parseInt(a[1],10),c=a.slice(2);if(b!==c.length)throw new Error("Parse error: "+b+" expected for number of channels, but "+c.length+".");return this.currentNode.channels=c,this.next()},f.prototype.motion=function(){this._nodeList=this.currentNode.flatten(),this.expect("MOTION").frames().frameTime();for(var a=0,b=this.numFrames;a<b;a++)this.frameValues();return this},f.prototype.frames=function(){var a=/^Frames:\s+(\d+)\s*$/.exec(this.get());if(a===null)throw new Error("Parse error: Cannot find valid number of frames");return this.numFrames=+a[1],this.next()},f.prototype.frameTime=function(){var a=/^Frame Time:\s+([0-9.]+)$/.exec(this.get());if(a===null)throw new Error("Parse error: Cannot find valid frametime");return this.frameTime=+a[1],this.next()},f.prototype.frameValues=function(){var a=this.get().split(/\s+/),b=this;this._nodeList.forEach(function(b){if(a.length<b.channels.length)throw new Error("Parse error: Too short motion values per frame");b.frames.push(a.splice(0,b.channels.length).map(function(a){return+a}))});if(a.length>0)throw new Error("Parse error: Too much motion values per frame");return this.next()},f.prototype.expect=function(a,b){if(this.accept(a))return b&&b(this.get()),this.next();throw new Error("Parse error: Unexpected token "+this.get()+" for "+a)},f.prototype.accept=function(a){var b=this.get();return b===undefined?!1:b.split(/\s+/)[0]==a},f.prototype.next=function(){do this._lineNumber++;while(this.get()==="");return this},f.prototype.get=function(){return typeof this._lines[this._lineNumber]=="undefined"?undefined:this._lines[this._lineNumber].replace(/(^\s+)|(\s+$)/g,"")}}),c.register("bvh_node.js",function(a,b,c,d){function e(a){this.id=a,this.children=[],this.parent=null,this.frames=[],this.channels=null,this.hasEnd=!1}a.exports=e,e.prototype.at=function(a){var b=this;a|=0,this.currentFrame=a;var c=this.frames[a-1];return this.channels.forEach(function(a,d){var e=a.slice(1)+a.slice(0,1).toUpperCase();b[e]=c[d]}),this},e.prototype.flatten=function(){function a(b){var c=[b];for(var d=0,e=b.children.length;d<e;d++)c=c.concat(a(b.children[d]));return c}return a(this)},e.prototype.toString=function(){function a(b,c){var d=[c+"- "+b.id];for(var e=0,f=b.children.length;e<f;e++)d=d.concat(a(b.children[e],c+"   "));return d}return a(this,"").join("\n")}}),c.register("bvh.js",function(a,b,c,d){function e(a){function b(a,c){if(c[a.id])throw new Error("Error: Node "+a.id+" already exists");c[a.id]=a;for(var d=0,e=a.children.length;d<e;d++)b(a.children[d],c);return c}this.root=a.currentNode,this.numFrames=a.numFrames,this.frameTime=a.frameTime,this.nodeList=this.root.flatten(),this._nodeIndex=b(this.root,{})}a.exports=e,e.prototype.at=function(a){a|=0;for(var b in this._nodeIndex)this._nodeIndex[b].at(a);return this},e.prototype.of=function(a){return this._nodeIndex[a]}}),BVH=c("index")})();